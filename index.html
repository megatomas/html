<!DOCTYPE html>
<html>
  <head>
    <title>Форма ввода</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    <form enctype="multipart/form-data">
      <div>
        <input type="text" id="fullname" name="fullname" placeholder="Клиент">
        <textarea id="address" name="address" placeholder="Адрес"></textarea>
        <input type="text" id="phone" name="phone" placeholder="Телефон" value="+7">
        <select id="type" name="type">
          <option value="hot_water">Горячая вода</option>
          <option value="cold_water">Холодная вода</option>
        </select>
        <input type="text" id="model" name="model" placeholder="Модификация">
        <input type="text" id="serial" name="serial" placeholder="Заводской номер">
        <input type="text" id="year" name="year" placeholder="Год выпуска">
        <input type="text" id="reading" name="reading" placeholder="Показания">
      </div>
      <div id="error"></div>
      <div>
        <button type="submit" id="submit">Отправить</button>
        <button type="reset" id="reset">Отмена</button>
      </div>
    </form>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
      let tg = window.Telegram.WebApp;
      let submit = document.getElementById("submit");
      let reset = document.getElementById("reset");

      tg.expand();

    submit.addEventListener("click", () => {
        let fullname = document.getElementById("fullname").value;
        let address = document.getElementById("address").value;
        let phone = "+7" + document.getElementById("phone").value; // добавляем "+7" к значению поля "Телефон"
        let type = document.getElementById("type").value;
        let model = document.getElementById("model").value;
        let serial = document.getElementById("serial").value;
        let year = document.getElementById("year").value;
        let reading = document.getElementById("reading").value;

        document.getElementById("error").textContent = ""; // очищаем сообщение об ошибке

        if (fullname.trim() === "") {
          document.getElementById("error").textContent = "Пожалуйста, введите имя клиента";
          return;
        }

        if (address.trim() === "") {
          document.getElementById("error").textContent = "Пожалуйста, введите адрес";
          return;
        }

        if (phone.trim().length < 12) { // проверяем, что длина телефона с добавленным "+7" равна 12
          document.getElementById("error").textContent = "Пожалуйста, введите корректный номер телефона";
          return;
        }

        if (model.trim() === "") {
          document.getElementById("error").textContent = "Пожалуйста, введите модификацию";
          return;
        }

        if (serial.trim() === "") {
          document.getElementById("error").textContent = "Пожалуйста, введите заводской номер";
          return;
        }

        if (year.trim() === "") {
          document.getElementById("error").textContent = "Пожалуйста, введите год выпуска";
          return;
        }

        if (reading.trim() === "") {
          document.getElementById("error").textContent = "Пожалуйста, введите показания";
          return;
        }

        let data = {
          fullname: fullname,
          address: address,
          phone: phone,
          type: type,
          model: model,
          serial: serial,
          year: year,
          reading: reading
        };
        tg.sendData(JSON.stringify(data));
        tg.close();
      });


    reset.addEventListener("click", () => {
      tg.close();
    });
    </script>
  </body>
</html>
